# Thesis_programs
All necessary codes for reproducing data from my thesis

The file summary.md gives a brief outline of which codes are included here. In this README I will discuss how results presented in the thesis are obtained.

Most results concern test particle orbits. 2D results are obtained by setting FMOD = CMT in line 14 of global_mod.f90 and 3D results are found by setting FMOD to CMT2. The simple model and braking jet model both exist in CMTfields_mod.f90 with certain lines being commented in/out to ensure that the correct transformation is used. The simple model is used as long as lines 59-65 are commented out and lines 57 and 137-145 are not commented out, the reverse is true for the braking jet model.

Initial conditions are specified in newinput.dat. When setting up either the simple model or the braking jet model it is extremely important to make sure that the correct initial time and time scale are set up for the model in question. The simple model takes an initial time of 105.0 and has a time scale of 100.0, whereas the braking jet model starts at 0.0 and has a time scale of 10.0. 

I will discuss how to generate figures and tables that present new results, grouping together figures which are generated by similar processes.

Chapter 2

Figures 16, 18, 20, 21, 23, 24, 25, 26, 28, 29, 30: These figures are all generated by scattercol4.pro which reads in data sets, finds the ratio of final to initial field strength and the ratio of final to initial energy and plots these against each other. The final time is determined as the final crossing of the loop top. To display several data sets at once the program uses the wkdir variable in getrdata.pro to obtain results from different data sets. By default, results are drawn from the Data/DataR directory, but relevant data sets can be grouped in named directories which are then set equal to wkdir. When fewer datasets are displayed in a figure, lines of code relating to data sets not in use can be commented out.

Figure 17: These simple plots show information about the Fermi acceleration contribution to the particle's energy. This property is found by setting a dataset ds=getrdata(n,/ke). From here ds.e5 will describe the size of this term at each point in time. In fact, e4-e9 all keep track of terms on the right hand side of dgamma/dt. Their meanings are secribed in r_kdrive_mod.f90

Figure 19: This is also produced using scattercol4.pro. To obtain test particle orbits in fields that collapse faster it is necessary to change the variables esp and cc on lines 111 and 112 of global_mod.f90.

Chapter 3 / Appendix A

Figures 38, 39, 46, 57, 58, 60, 67: These figures uses abenergies.pro to show multiple energy profiles at once for particles in the 3D CMT with a braking jet. The lower bound for x and z in newinput.dat is -1.2e7 and the upper bound is -0.001e7. This means that particles start very close to but not at x=0 or z=0. This prevents a singularity in the terms dr/dx or drdz found in CMTfields_mod.f90, which would become 0/0 with these numbers.

Figures 41, 42, 49, 61, 63, 65: These figures show how the energies of particles change with time by plotting ds.ke against ds.t, where the dataset is obained using ds = getrdata(n,/ke)

Figures 43, 59: Similar to the scatter plots in the previous chapter, though these one uses abscatter.pro so that particles which escape early appear greyer (where applicable). 

Figures 44, 45, 48, 62, 64, 66: Particle trajectories (in the x-y plane) are shown by plotting ds.y against ds.x. 

Figure 47: Similar to Figures 38, 39 and 46, but with the pitch angle and z varied instead of x and z.

Figure 50, Movies 1 and 2: The frames used to make these movies (an example of which is given in Figure 50) are generated using CMTframegen.pro. Similar to the field line plotting routines, this program requires that the necessary field is specified in both this program and CMTODEINT.pro. When the type of fiel is chosen (2D without jet, twisted, with jet etc.) then lines 563 and 649 mustalso be changed to reflect this.

Figures 51, 52, 53, 106, 107, 108, 109, 110: These Figures are generated using jet_energy_v_pitch.pro which takes a datset and measures the final energy of each particle. These final energies are then plotted against a factor related to the initial conditions, in this case initial pitch angles.

Figures 54, 55: Distributions of the final energies of particles are obtained using energy_bins.pro

Figures 56: This plot of a large number of particle trajectories is obtained using manyplots.pro, which works similarly to abenergies.pro, but which can be used to plot trajectories (in the x-y plane) instead of energy against time. The grids have been added manually later.

Chapter 4

All estimates are found using either fermiguessfor.f90 or fermiguess3d.f90. I'll briefly summarise how initial conditions are specified and where variables can be changed.

In lines 37-55 the initial conditions are defined by specifying a maximum and minimum as well as the numberof uniform steps taken between these values. If only one value for a given condition is used then the number of steps must be set to 1 and the relevant line must be adjusted in the do loops to avoid a singularity. For example if only one initial value of x is tested, then xsteps should be set to 1. After this the denominator of line 67 whould be set to xsteps rather than the value of (xsteps-1) which would be used if multiple initial x values were simulated.

The variables which affect the speed and accuracy of the estimator are lised in Appendix B. Some of these are specified at the start of fermiguessfor.f90 and others are specified in their relevant subroutines. Since these variables are explained in the thesis I will only mention which lines they are specified on below:
steps - line 33 (if a constant number of steps are used, if the value in Equation (70) is used instead then this equation is found on lines 86 and 87)
looptopsteps - line 34
looptoptol - line 35
hfp - line 260
hlptp - line 315
hTiL - line 440
hbet - line 789
ht0 - line 494
ndrift - lines 708 and 716 as an argument of driftevo

Figure 69: Same process as Figure 19

Figures 70, 71, 72, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 101, 102, 103, 104, 105 : Uses fermiguessforcharts.pro to compare full orbit data in black against estimator data in red.

Figure 73: A scatter plot which also uses fermiguessforcharts.pro with an overlay of the contribution of Fermi acceleration in the early steps, displayed in a similar way to Figure 17.

Tables 6, 7, 8, 9: These tables are constructed using information obtained from estaccuracytest.pro for each separate estimate.

Figures 89, 91, 92, 93: These charts use estaccuracyplots.pro and information from estaccuracytest.pro to construct images showing where the initial positions associated with large overestimates and underestimates in the energy are located for different ranges of initial pitch angle.

Table 10: Similar to the other tables in this chapter, but for this table estaccuracytest.pro was modified slightly to compare two full orbit calculations instead of an estimate and a full orbit calculation.

Figures 94, 95, 96, 97, 98, 100: These charts are reliant on a small modification to fermiguessfor.f90 and fermiguessforcharts.pro. The estimator fermiguessfor.f90 now gives an escape time as its output (100s if the particle remains trapped for the whole simulation) and fermiguessforcharts.pro plots this escape time against that for the full orbit calculations, also displaying the intial x position on the horizontal axis instead of the ratio of final to initial field strength.

Figures 99, 100 : These plots also use a modified version of fermiguessforcharts.pro, comparing the final energies of full orbits and the output of the estimator, displaying the initial x position on the horizontal axis instead of the ratio of final to initial field strength.
 
